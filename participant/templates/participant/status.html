{% extends 'base.html' %}
{% block content %}
<div class="max-w-md mx-auto p-4">
    <div class="card bg-base-200/70 shadow-xl">
        <div class="card-body">
            <h1>Queue: <span id="queueName"></span></h1>
            <p>Participant: <span id="participantName"></span></p>
            <p>Position: <span id="position"></span></p>
            <p>Estimated Wait Time: <span id="waitTime"></span></p>
        </div>
    </div>
</div>

<script>
        const eventSource = new EventSource('/status/{{ participant.code }}/sse');

        eventSource.onmessage = function(event) {
            try {
                const data = JSON.parse(event.data);
                console.log("Received data:", data);

                // Update each part of the page as data is received
                document.getElementById('queueName').innerText = data.queue_name;
                document.getElementById('participantName').innerText = data.participant[0].name;
                document.getElementById('position').innerText = data.participant[0].position;
                document.getElementById('waitTime').innerText = data.participant[0].estimated_wait_time;
            } catch (error) {
                console.error("Error parsing JSON data:", error);
            }
        };

        eventSource.onerror = function(error) {
            console.error("Error in SSE connection:", error);
        };
    </script>
{% endblock %}
