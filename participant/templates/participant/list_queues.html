{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="container mx-auto p-4 max-w-4xl">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-2xl font-bold mb-6">{{ queue_type }} Queues</h2>
                <div class="form-control mb-6">
                    <div class="input-group">
                        <input
                            type="text"
                            id="searchBar"
                            placeholder="Search queues..."
                            class="input input-bordered w-full"
                            oninput="searchQueues()"
                        >
                    </div>
                </div>

                <div id="openQueues" class="space-y-4">
                    {% if queues %}
                        {% for queue in queues %}
                            {% if not queue.is_closed %}
                                <div class="queue-block card bg-base-200 shadow-sm hover:shadow-md transition-shadow"
                                     data-queue-name="{{ queue.name|lower }}">
                                    <div class="card-body p-4">
                                        <div class="flex items-start gap-4">
                                            <img src="{{ queue.get_logo_url }}"
                                                 alt="{{ queue.name }} logo"
                                                 class="w-12 h-12 rounded-lg object-cover">
                                            <div class="flex-1">
                                                <div class="flex justify-between items-start">
                                                    <h3 class="queue-title text-lg font-semibold">{{ queue.name }}</h3>
                                                    <div class="badge badge-lg
                                                        {% if queue.queue_status == 'full' %} badge-error
                                                        {% elif queue.queue_status == 'busy' %} badge-warning
                                                        {% elif queue.queue_status == 'Normal' %} badge-success
                                                        {% endif %}">
                                                        {{ queue.queue_status }}
                                                    </div>
                                                </div>
                                                <p class="text-base-content/70 mt-1">{{ queue.description }}</p>
                                                <p class="text-sm mt-2">
                                                    Currently in queue:
                                                    {% if queue.get_number_of_participants == 1 %}
                                                        1 person
                                                    {% else %}
                                                        {{ queue.get_number_of_participants }} people
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-8 text-base-content/70">
                            No queues available.
                        </div>
                    {% endif %}
                </div>

                <div id="noOpenQueuesMessage" class="text-center py-8 text-base-content/70" style="display: none;">
                    No queues found matching your search.
                </div>
            </div>
        </div>
    </div>

    <script>
        function searchQueues() {
            const input = document.getElementById('searchBar').value.toLowerCase();
            const openQueues = document.querySelectorAll('#openQueues .queue-block');
            let openCount = 0;

            openQueues.forEach(queue => {
                const title = queue.querySelector('.queue-title').textContent.toLowerCase();
                if (title.includes(input)) {
                    queue.style.display = '';
                    openCount++;
                } else {
                    queue.style.display = 'none';
                }
            });

            document.getElementById('noOpenQueuesMessage').style.display = openCount === 0 ? '' : 'none';
        }
    </script>
{% endblock %}
